---
title: "Regression Plots"
author: "Devlin Moyer"
date: "4/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NA)
options(max.print = 50)
```

Do this again but allow export of every metabolite

# Setup

```{r warning=F}
# for a better logistic regression function than the one in base R
library(rms)
# mostly for plotting aesthetics
library(tidyverse)
theme_set(theme_bw())

# load data from simulations
data <- read.table(
  "../data/min_env_test_ab_5_5ins_3outs_10000envs_10bms.tsv",
  sep = "\t",
  col.names = c("Biomass", "Environment", "Growth")
)

data <- data %>%
  # since so many growth fluxes were 0, make an indicator of growth variable to do logistic regression on
  mutate(binary_growth = ifelse(Growth == 0, 0, 1))
```

# Look at the Data

```{r}
ggplot(data, aes(sample = Growth)) + geom_qq() + geom_qq_line(col = "red") + 
  labs(title = "Normal Q-Q Plot of Growth Fluxes")
```

When doing linear regression, it is generally assumed that the outcome variable is normally distributed. That is clearly not the case here, mostly due to the preponderance of 0s. The 0s are also problematic because the usual workaround to non-normally distributed outcomes is transforming the variable, e.g. squaring all values or taking the logarithm, but none of those will help with the 0 problem. I think a good response to the large number of 0 values is to instead predict growth/no growth using logistic regression, ignoring the values of the nonzero growth fluxes. 
# Linear Regression to Predict Growth Flux

## Predicting Growth with Environment

```{r}
env_fit <- lm(Growth ~ Environment, data = data)
summary(env_fit)
```

The adjusted R-squared value for this model is negative, which means it is aprroximately as bad as it can possibly be.

## Predicting Growth with Biomass

```{r}
bm_fit <- lm(Growth ~ Biomass, data = data)
summary(bm_fit)
```

Most biomass reactions are significant predictors of growth, which is nice, but this model still only accounts for about 36% of variation in growth fluxes. 

# Logistic Regression to Predict Growth/No Growth

As previously mentioned, it might improve matters to make a this a binary classifcation model where we're just trying to predict if there will be growth or not.

## Predicting Growth with Environment

```{r}
logistic_env_model <- lrm(binary_growth ~ Environment, data = data[1:10000,], x = T, y = T, maxit = 1000)
logistic_env_model
```

The Nagelkerke R-squared value for this model is only 0.18, which is pretty bad (a Nagelkerke R-squared of 0 corresponds to a model that predicts the mean outcome for all samples; the maximum possible nageklerke R-squared is 1). The C-statistic (AUC) is 0.769, which is also mediocre. I abbreviated the output here, but trust me when I say that none of the environments was even a remotely good predictor, as was the case with the linear model.

## Predicting Growth with Biomass

```{r}
logistic_bm_model <- lrm(binary_growth ~ Biomass, data = data, x = T, y = T)
logistic_bm_model
```

Each biomass reaction is a significant predictor of growth. The Nagelkerke R-squared and C-statistic for this model are noticeably better than from the previous model: an R-squared of 0.39 is still pretty bad, but an AUC of 0.856 is actually okay.

# Conclusions

Neither the environmental composition nor the biomass reaction is a particularly good predictor of growth flux for an arbitrary pruned string chemsitry network. It seems that the best model that can be made for this data is a logistic regression model that just predicts whether or not there will be growth based only on the biomass reaction.

---
title: "Regression Plots"
author: "Devlin Moyer"
date: "4/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NA)
options(max.print = 50)
```

Do this again but allow export of every metabolite

# Setup

```{r warning=F}
# for a better logistic regression function than the one in base R
library(rms)
# mostly for plotting aesthetics
library(tidyverse)
theme_set(theme_bw())

# load data from simulations
data <- read.table(
  "../data/min_env_test_ab_5_5ins_3outs_10000envs_10bms.tsv",
  sep = "\t",
  col.names = c("Biomass", "Environment", "Growth")
)

data <- data %>%
  # since so many growth fluxes were 0, make an indicator of growth variable to do logistic regression on
  mutate(binary_growth = ifelse(Growth == 0, 0, 1))
data %>%
  mutate(Growth = as.numeric(as.character(Growth))) %>%
  group_by(Growth) %>%
  summarize(count = n())
```

# Look at the Data

```{r}
ggplot(data, aes(sample = Growth)) + geom_qq() + geom_qq_line(col = "red") + 
  labs(title = "Normal Q-Q Plot of Growth Fluxes")
```

When doing linear regression, it is generally assumed that the outcome variable is normally distributed. That is clearly not the case here, mostly due to the preponderance of 0s. The 0s are also problematic because the usual workaround to non-normally distributed outcomes is transforming the variable, e.g. squaring all values or taking the logarithm, but none of those will help with the 0 problem. I think a good response to the large number of 0 values is to instead predict growth/no growth using logistic regression, ignoring the values of the nonzero growth fluxes. 

# Linear Regression to Predict Growth Flux

## Predicting Growth with Environment

```{r}
predict_growth_value <- function(biomass) {
  value_fit <- lm(Growth ~ Environment, data = filter(data, Biomass == biomass))
  return(summary(value_fit))
}
lapply(unique(data$Biomass), predict_growth_value)
```

The adjusted R-squared value for this model is negative, which means it is aprroximately as bad as it can possibly be.

# Logistic Regression to Predict Growth/No Growth

As previously mentioned, it might improve matters to make a this a binary classifcation model where we're just trying to predict if there will be growth or not.

## Predicting Growth with Environment

```{r}
predict_growth_binary <- function(biomass) {
  logistic_fit <- lrm(binary_growth ~ Environment, data = filter(data, Biomass == biomass), x = T, y = T, maxit = 1000)
  return(logistic_fit)
}
lapply(unique(data$Biomass), predict_growth_binary)
```

The R-squared and AUC are both exactly 1, which is extremely suspcious. That's probably nonsense since the estimated coefficient of each environment is 0 with a massive standard error, so I think the model just completely failed.

# Conclusions

Neither the environmental composition nor the biomass reaction is a particularly good predictor of growth flux for an arbitrary pruned string chemsitry network. It seems that the best model that can be made for this data is a logistic regression model that just predicts whether or not there will be growth based only on the biomass reaction.
